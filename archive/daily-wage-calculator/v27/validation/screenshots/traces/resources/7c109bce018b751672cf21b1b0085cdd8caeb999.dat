import{r as n,b7 as r,bB as h,j as S,bL as a}from"./assets/index-rhBbSAok.js";import{c as b,a as E}from"./createSheetsRow-rAhDxP-u__cache.js";const k={rows:[],computed:{anyRowWithError:!1,anyFilterApplied:!1,isDirty:!1}},R=n.createContext({state:k,initializeSheetsData:r.noop,addSheetsRow:r.noop,deleteSheetsRow:r.noop,cloneSheetsRow:r.noop,updateSheetsCell:r.noop,storeSavedSheetsRows:r.noop,syncSheetsRowsAfterCall:r.noop,restartSheets:r.noop,importSheetsRowsFromExcel:r.noop,sortSheetsRows:r.noop,addSheetsFilter:r.noop,changeSheetsFilterValue:r.noop,updateRows:r.noop}),N=()=>{const o=n.useContext(R);return h(o,"useSheetsDataContext must be used within a SheetsDataContextProvider"),o},A=({children:o,value:e})=>S.jsx(R.Provider,{value:e,children:o}),W=o=>a(e=>{e.filters=[...e.filters??[],o]});function d(o,e,s,t){return o.filter(l=>e.every(c=>s[c.key]===void 0?!0:c.function(l,s,t)))}function w(o){return h(o.configuration,"Cannot get filter rows without configuration"),o.filterValues&&Object.keys(o.filterValues).length>0?d(o.rows,o.filters??[],o.filterValues,o.configuration):o.filteredRows}const j=()=>a(o=>{h(o.configuration,"Cannot add row without configuration");const e=b({cells:new Array(o.configuration.columns.length).fill({content:void 0,displayValue:""}),recordStatus:"new",validityStatus:"valid"});o.rows=[...o.rows,e],o.filteredRows=w(o)}),$=(o,e)=>a(s=>{var t;r.isUndefined(e)?(t=s.filterValues)==null||delete t[o]:s.filterValues?s.filterValues[o]=e:s.filterValues={[o]:e},s.configuration&&s.filterValues&&Object.keys(s.filterValues).length>0?(s.filteredRows=d(s.rows,s.filters??[],s.filterValues,s.configuration),s.computed.anyFilterApplied=!0):(s.computed.anyFilterApplied=!1,s.filteredRows=void 0,s.filterValues=void 0)}),I=o=>a(e=>{h(e.configuration,"Cannot clone row without configuration");const s=e.rows.findIndex(c=>c.id===o),t=e.rows[s],l=E(t);if(l.recordStatus="new",e.configuration.columns.forEach((c,u)=>{c.avoidClone&&(l.cells[u]={...l.cells[u],content:void 0})}),e.rows.splice(s+1,0,l),e.filterValues&&e.filteredRows){const c=e.filteredRows.findIndex(u=>u.id===o);e.filteredRows.splice(c+1,0,l)}e.computed.isDirty=!0}),p=o=>o.validityStatus==="has-error",z=o=>a(e=>{h(e.configuration,"Cannot delete row without configuration");const s=e.rows.findIndex(t=>t.id===o);if(e.rows.splice(s,1),e.filteredRows){const t=e.filteredRows.findIndex(l=>l.id===o);t!==-1&&e.filteredRows.splice(t,1)}e.computed.isDirty=!0,e.computed.anyRowWithError=e.rows.some(p)}),O=o=>a(e=>{e.computed={isDirty:!0,anyRowWithError:o.some(p),anyFilterApplied:!1},e.rows=o,e.filteredRows=w(e)}),P=o=>a(e=>{e.configuration=o,e.rows=o.rows,e.computed={anyRowWithError:e.rows.some(p),anyFilterApplied:!1,isDirty:!1},e.filterValues=void 0,e.filteredRows=void 0}),B=()=>a(o=>{var e;o.rows=((e=o.configuration)==null?void 0:e.rows)??[],o.computed={anyRowWithError:!1,anyFilterApplied:!1,isDirty:!1},o.filterValues=void 0,o.filteredRows=void 0}),L=o=>a(e=>{e.rows=o,e.filteredRows=w(e)}),M=o=>a(e=>{e.computed={isDirty:!1,anyRowWithError:!1,anyFilterApplied:!1},e.rows=[],e.savedRows=o,e.filterValues=void 0,e.filteredRows=void 0}),U=o=>a(e=>{e.computed={isDirty:!1,anyRowWithError:o.some(p),anyFilterApplied:!!e.filterValues&&Object.keys(e.filterValues).length>0},e.rows=o,e.filteredRows=w(e)}),q=({cellIndices:o,newCell:e,newRow:s})=>a(t=>{let l=t.rows[o[0]];if(t.computed.anyFilterApplied){const c=t.rows.findIndex(u=>u.id===s.id);c!==-1&&(l=t.rows[c])}l.cells=[...s.cells],l.cells[o[1]]=e,l.validityStatus="valid",l.recordStatus!=="new"&&(l.recordStatus="modified"),t.computed.isDirty=!0,t.computed.anyRowWithError=t.rows.some(p),t.filteredRows=w(t)}),G=o=>a(e=>{e.computed.isDirty=!0,e.rows=o,e.filteredRows=w(e)}),Q=({children:o})=>{const[e,s]=n.useState({rows:[],computed:{anyRowWithError:!1,isDirty:!1,anyFilterApplied:!1}}),t=n.useCallback(i=>{s(P(i))},[]),l=n.useCallback(()=>{s(j())},[]),c=n.useCallback(i=>{s(z(i))},[]),u=n.useCallback(i=>{s(I(i))},[]),y=n.useCallback(i=>{s(q(i))},[]),m=n.useCallback(i=>{s(M(i))},[]),C=n.useCallback(i=>{s(U(i))},[]),f=n.useCallback(()=>{s(B())},[]),x=n.useCallback(i=>{s(O(i))},[]),g=n.useCallback(i=>{s(L(i))},[]),D=n.useCallback(i=>{s(W(i))},[]),v=n.useCallback((i,V)=>{s($(i,V))},[]),F=n.useCallback(i=>{s(G(i))},[]);return S.jsx(A,{value:{state:e,initializeSheetsData:t,addSheetsRow:l,deleteSheetsRow:c,cloneSheetsRow:u,updateSheetsCell:y,storeSavedSheetsRows:m,syncSheetsRowsAfterCall:C,restartSheets:f,importSheetsRowsFromExcel:x,sortSheetsRows:g,addSheetsFilter:D,changeSheetsFilterValue:v,updateRows:F},children:o})};export{Q as S,p as h,N as u};
