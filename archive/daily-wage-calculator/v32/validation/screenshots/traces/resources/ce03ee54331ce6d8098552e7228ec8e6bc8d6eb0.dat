import{br as V,dc as w,H as G,a as S,j as t,S as L,bb as q,T as F,W as z,r as p,cf as Q,a8 as _,jg as E,cA as $,ah as A,C as J,d as X}from"./assets/index-rhBbSAok.js";import{B as Y,P as c}from"./CompanyBankDetails-uM9hiMgz__cache.js";import{O as h,g as P,a as Z,u as v,b as ee,B as te}from"./Bank-87nXGUR4__cache.js";import{u as ae}from"./useCompanyCountry-au303yAF__cache.js";import{F as U}from"./Autocomplete.form-u8H5zvYs__cache.js";import{F as oe}from"./RadioGroupInput.form-MIArba2b__cache.js";import{F as K}from"./Select.form-INoc4nXN__cache.js";import{F as B}from"./TextField.form-wfmQrmdl__cache.js";import{c as ne}from"./final-form-calculate.es-bn-nJtjC__cache.js";import{m as re}from"./maxLengthGenerator-lvQvKiVB__cache.js";import{v as ie}from"./validateIban-ok8dHO9Z__cache.js";const se=e=>{var o,f,i,u;return e?e.country===Y.UnitedArabEmirates?{...e,tradeLicense:(o=e.tradeLicense)==null?void 0:o.id,commercialRegistration:(f=e.commercialRegistration)==null?void 0:f.id}:{...e,tradeLicense:(i=e.tradeLicense)==null?void 0:i.id,commercialRegistration:(u=e.commercialRegistration)==null?void 0:u.id,otherCountryAbaNumber:e.abaNumber,otherCountryAccountNumber:e.accountNumber,otherCountryAccountHolder:e.accountHolder,otherCountryBankName:e.bankName,otherCountryBeneficiaryBankAddress:e.beneficiaryBankAddress,otherCountryIban:e.iban,otherCountryIfscCode:e.ifscCode,otherCountryRoutingCode:e.routingCode,otherCountrySortCode:e.sortCode,otherCountrySwiftBicCode:e.swiftBicCode}:{accountType:c.UaeBank}},H=e=>e.values.accountType===c.OtherCountryBank?w(e):void 0,j=e=>e.values.accountType===c.UaeBank?w(e):void 0,y=({fieldName:e})=>o=>{if(o.values.country&&o.values.accountType!==c.UaeBank&&P(o.values.country).mandatoryFields.has(e))return w(o)},ce=V({accountHolder:[j,re({length:1e3})],iban:[j],bankName:[j],routingCode:[j],country:[H],otherCountryAbaNumber:[y({fieldName:h.AbaNumber})],otherCountryAccountHolder:[H],otherCountryAccountNumber:[H],otherCountryBankName:[y({fieldName:h.BankName})],otherCountryBeneficiaryBankAddress:[y({fieldName:h.BeneficiaryBankAddress})],otherCountryIban:[y({fieldName:h.Iban})],otherCountryIfscCode:[y({fieldName:h.IfscCode})],otherCountryRoutingCode:[y({fieldName:h.RoutingCode})],otherCountrySortCode:[y({fieldName:h.SortCode})],otherCountrySwiftBicCode:[y({fieldName:h.SwiftBicCode})]}),a=X({confirmDeletion:{id:"hr.app.page.configuration.settings-list-item.delete-title",defaultMessage:"Confirm deletion"},deleteQuestion:{id:"hr.app.page.configuration.payroll.bank-accounts.delete-question",defaultMessage:"Are you sure you want to delete <strong>{itemName}</strong>?"},delete:{id:"common.action.delete",defaultMessage:"Delete"},editBankAccount:{id:"hr.app.page.configuration.payroll.bank-accounts.form.edit-account",defaultMessage:"Edit a bank account"},addBankAccount:{id:"hr.app.page.configuration.payroll.bank-accounts.form.new-account",defaultMessage:"Add a new bank account"},save:{id:"common.action.save",defaultMessage:"Save"},countryBankAccount:{id:"hr.app.page.configuration.payroll.bank-accounts.form.country-account",defaultMessage:"Country of Bank Account"},countryOfBank:{id:"hr.payroll.account.country",defaultMessage:"Country of Bank"},selectCountry:{id:"hr.payroll.account.select-country",defaultMessage:"Select Country"},additionalInfo:{id:"hr.payroll.account.additional-info",defaultMessage:"Additional Information (Optional)"},accountHolderName:{id:"hr.app.page.configuration.payroll.bank-accounts.form.account-holder",defaultMessage:"Account Holder Name"},iban:{id:"hr.app.page.configuration.payroll.bank-accounts.iban",defaultMessage:"IBAN"},bankName:{id:"hr.app.page.configuration.payroll.bank-accounts.bank-name",defaultMessage:"Bank Name"},routingCode:{id:"hr.app.page.configuration.payroll.bank-accounts.form.routing-code",defaultMessage:"Routing Code"},tradeLicense:{id:"hr.app.page.configuration.payroll.bank-accounts.form.trade-license",defaultMessage:"Trade License"},commercialRegistration:{id:"hr.app.page.configuration.payroll.bank-accounts.form.commercial-registration",defaultMessage:"Commercial Registration"},establishmentId:{id:"hr.app.page.configuration.payroll.bank-accounts.form.establishment-id",defaultMessage:"Establishment ID*"},abcId:{id:"hr.app.page.configuration.payroll.bank-accounts.form.abc-id",defaultMessage:"ABC ID"},ksa:{id:"hr.app.page.configuration.payroll.bank-accounts.form.ksa",defaultMessage:"KSA"},outsideKsa:{id:"hr.app.page.configuration.payroll.bank-accounts.form.outside-ksa",defaultMessage:"Outside KSA"},uae:{id:"hr.app.page.configuration.payroll.bank-accounts.form.uae",defaultMessage:"UAE"},outsideUae:{id:"hr.app.page.configuration.payroll.bank-accounts.form.outside-uae",defaultMessage:"Outside UAE"},addEstablishmentId:{id:"hr.app.page.configuration.payroll.bank-accounts.form.add-establishment-id",defaultMessage:"Please add establishmentID for this CR in company documents"}}),de=G()(e=>({dialogTitle:{display:"flex",alignItems:"center"},mediumRightMargin:{marginRight:e.spacing(2),width:42,height:42}})),Ne=({handleClose:e,bankName:o,handleSubmit:f,isLoading:i})=>{const{classes:u}=de(),d=S();return t.jsx(L,{maxWidth:"sm",fullWidth:!0,title:t.jsxs("div",{className:u.dialogTitle,children:[t.jsx(q,{color:"error",fontSize:"small",className:u.mediumRightMargin}),t.jsx(F,{variant:"h4",children:d.formatMessage(a.confirmDeletion)})]}),content:t.jsx(F,{variant:"body1",children:d.formatMessage(a.deleteQuestion,{itemName:o,strong:s=>t.jsx("strong",{children:s})})}),isPending:i,confirmButton:{color:"error",text:d.formatMessage(a.delete),onClick:f},cancelButton:{show:!0,color:"error",onClick:e}})},xe=({tradeLicenses:e,bankAccount:o,onSubmit:f,onCloseDialog:i,open:u,commercialRegistrations:d,handleSabIntegration:s})=>{const r=z(),C=S(),T=ce(),[M,k]=p.useState([]),{mutateAsync:N,isPending:O}=Z();p.useEffect(()=>{u&&k([])},[u]);const R=p.useMemo(()=>ne({field:"iban",updates:{bankName:async b=>{if(ie(b,["AE","SA"])){const g=await N({urlParams:{companyId:r,iban:b}});return k(g.routingCodes),s&&s(g.isSabb),g.name}return k([]),""}}}),[r,N,s]);return u?t.jsx(Q,{onSubmit:f,validate:T,decorators:[R],initialValues:se(o),render:({handleSubmit:b,hasValidationErrors:g,form:x,values:I})=>t.jsx(L,{"data-external-id":"new-bank-account-modal",open:u,fullWidth:!0,maxWidth:"md",title:o?C.formatMessage(a.editBankAccount):C.formatMessage(a.addBankAccount),content:t.jsx(ue,{tradeLicenses:e??[],commercialRegistrations:d??[],values:I,routingCodes:M,isBankDetailsLoading:O,form:x,selectedBankCountry:I.country}),confirmButton:{onClick:b,text:C.formatMessage(a.save),disabled:g},cancelButton:{show:!0,onClick:i}})}):null},ue=({tradeLicenses:e,routingCodes:o,isBankDetailsLoading:f,form:i,selectedBankCountry:u,values:d,commercialRegistrations:s})=>{var W;const r=S(),C=ae(),T=v(),M=_(ee);p.useEffect(()=>{o.length===1&&i.change("routingCode",o[0])},[o,i]),p.useEffect(()=>{C===E.KingdomOfSaudiArabia&&d.accountType===c.UaeBank&&i.change("accountType",c.KsaBank)},[C,i,d.accountType]);const k=l=>{var n;return(n=T.find(m=>m.dataId===l))==null?void 0:n.label},{mandatoryFields:N,nonMandatoryFields:O}=p.useMemo(()=>P(u),[u]),R=()=>C===E.KingdomOfSaudiArabia?[{label:r.formatMessage(a.ksa),value:c.KsaBank},{label:r.formatMessage(a.outsideKsa),value:c.OtherCountryBank}]:[{label:r.formatMessage(a.uae),value:c.UaeBank},{label:r.formatMessage(a.outsideUae),value:c.OtherCountryBank}],b=()=>{var n;const l=(n=s==null?void 0:s.find(m=>m.id===d.commercialRegistration))==null?void 0:n.metadata;return(l==null?void 0:l.establishmentId)??""},g=d.accountType===c.UaeBank||d.accountType===c.KsaBank,x=d.accountType===c.KsaBank&&((W=d.bankName)==null?void 0:W.includes("SAB")),I=d.commercialRegistration&&x;return t.jsxs(t.Fragment,{children:[t.jsx(oe,{label:r.formatMessage(a.countryBankAccount),name:"accountType",options:R(),horizontal:!0}),t.jsx($,{subscription:{values:!0},render:({values:l})=>t.jsx(t.Fragment,{children:g?t.jsxs(t.Fragment,{children:[t.jsx(B,{label:r.formatMessage(a.accountHolderName),name:"accountHolder",fullWidth:!0}),t.jsx(B,{label:r.formatMessage(a.iban),name:"iban",fullWidth:!0,autoFocus:!0}),f?t.jsx(J,{sx:{mt:2}}):t.jsxs(t.Fragment,{children:[t.jsx(B,{label:r.formatMessage(a.bankName),name:"bankName",disabled:g,fullWidth:!0}),l.accountType===c.UaeBank&&t.jsx(K,{name:"routingCode",fullWidth:!0,label:r.formatMessage(a.routingCode),options:o,disabled:(o==null?void 0:o.length)<=1})]}),t.jsx(le,{bankName:l.bankName,routingCode:l.routingCode}),l.accountType===c.UaeBank&&t.jsx(t.Fragment,{children:t.jsx(K,{label:r.formatMessage(a.tradeLicense),name:"tradeLicense",fullWidth:!0,options:e==null?void 0:e.map(n=>n.id),renderOption:n=>{var m;return(m=e==null?void 0:e.find(D=>n===D.id))==null?void 0:m.title}})}),x&&t.jsx(U,{label:r.formatMessage(a.commercialRegistration),name:"commercialRegistration",fullWidth:!0,options:s==null?void 0:s.map(n=>n.id),getOptionLabel:n=>{var m;return((m=s==null?void 0:s.find(({id:D})=>D===n))==null?void 0:m.title)??""}}),I&&t.jsxs(t.Fragment,{children:[t.jsx(B,{label:r.formatMessage(a.establishmentId),placeholder:r.formatMessage(a.establishmentId),name:"establismentId",disabled:!0,fullWidth:!0,value:b()}),!b()&&t.jsx(F,{variant:"body2",color:"error",children:r.formatMessage(a.addEstablishmentId)})]})]}):t.jsxs(t.Fragment,{children:[t.jsx(U,{name:"country",label:r.formatMessage(a.countryOfBank),placeholder:r.formatMessage(a.selectCountry),options:te,getOptionLabel:M,renderOption:(n,m)=>M(m),fullWidth:!0}),l.country&&t.jsxs(t.Fragment,{children:[t.jsx(A,{container:!0,columnSpacing:2,children:[...N].map(n=>t.jsx(A,{alignItems:"stretch",alignContent:"stretch",size:6,children:t.jsx(B,{name:n,label:k(n),fullWidth:!0})},`${n}-mandatory`))}),t.jsx(F,{variant:"h6",color:"textPrimary",children:r.formatMessage(a.additionalInfo)}),t.jsx(A,{container:!0,columnSpacing:2,children:[...O].map(n=>t.jsx(A,{alignItems:"stretch",alignContent:"stretch",size:6,children:t.jsx(B,{name:n,label:k(n),fullWidth:!0})},`${n}-optional`))})]})]})})})]})},le=e=>{const o=S(),[f,i]=p.useState(!1);return p.useEffect(()=>{e.routingCode==="302020120"||e.bankName&&e.bankName.startsWith("HSBC ")?i(!0):i(!1)},[e,i]),!f||!e.routingCode?null:t.jsx(B,{label:o.formatMessage(a.abcId),name:"abcId",fullWidth:!0})},Ie=e=>({accountHolder:e.accountHolder,bank:e.bankName,abcId:e.abcId&&e.abcId.length>0?e.abcId:void 0,iban:e.iban,primaryAccount:e.primaryAccount,routingCode:e.routingCode&&e.routingCode.length>0?e.routingCode:void 0,tradeLicense:e.tradeLicense&&e.tradeLicense.length>0?e.tradeLicense:void 0,commercialRegistrationId:e.commercialRegistration?e.commercialRegistration:void 0}),Ae=e=>({abaNumber:e.otherCountryAbaNumber&&e.otherCountryAbaNumber.length>0?e.otherCountryAbaNumber:void 0,accountHolder:e.otherCountryAccountHolder&&e.otherCountryAccountHolder.length>0?e.otherCountryAccountHolder:void 0,accountNumber:e.otherCountryAccountNumber&&e.otherCountryAccountNumber.length>0?e.otherCountryAccountNumber:void 0,bankName:e.otherCountryBankName&&e.otherCountryBankName.length>0?e.otherCountryBankName:void 0,beneficiaryBankAddress:e.otherCountryBeneficiaryBankAddress&&e.otherCountryBeneficiaryBankAddress.length>0?e.otherCountryBeneficiaryBankAddress:void 0,country:e.country,iban:e.otherCountryIban&&e.otherCountryIban.length>0?e.otherCountryIban:void 0,ifscCode:e.otherCountryIfscCode&&e.otherCountryIfscCode.length>0?e.otherCountryIfscCode:void 0,routingCode:e.otherCountryRoutingCode&&e.otherCountryRoutingCode.length>0?e.otherCountryRoutingCode:void 0,sortCode:e.otherCountrySortCode&&e.otherCountrySortCode.length>0?e.otherCountrySortCode:void 0,swiftBicCode:e.otherCountrySwiftBicCode&&e.otherCountrySwiftBicCode.length>0?e.otherCountrySwiftBicCode:void 0,commercialRegistration:e.commercialRegistration?e.commercialRegistration:void 0});export{xe as B,Ne as D,Ae as a,Ie as c};
