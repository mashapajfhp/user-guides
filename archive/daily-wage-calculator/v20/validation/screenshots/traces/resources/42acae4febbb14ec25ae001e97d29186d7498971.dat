import{a as P,bS as K,j as l,d as W,bB as v,bM as X,r as Y,bK as j,bT as N}from"./assets/index-rhBbSAok.js";import{D as Z}from"./DropzoneFileUploader-pDMOyu5b__cache.js";import{d as _}from"./FileUploaderBase-rOZnb-He__cache.js";import{F as t,a as $}from"./FileUploadCard-SYKRFYl-__cache.js";import{F}from"./FileUploadsViewerModal-x4bY6Opz__cache.js";import{u as V}from"./useRequestQueue-unvDIQYp__cache.js";import{a as ee}from"./useFileUploadTracker-A5RLAxLM__cache.js";import{R as se}from"./RotateBackIcon-ndwsmtaY__cache.js";import{V as te}from"./View1Icon-IfE2VW6e__cache.js";import{D as ne}from"./DownloadBottomIcon-rr6q8xxr__cache.js";import{U as f}from"./types-syHtOx8i__cache.js";import{u as H}from"./utils-qnXsQVr6__cache.js";const b=W({delete:{id:"common.dropzone-file-uploader.delete",defaultMessage:"Delete"},retry:{id:"common.dropzone-file-uploader.retry",defaultMessage:"Retry"},download:{id:"common.dropzone-file-uploader.download",defaultMessage:"Download"},view:{id:"common.dropzone-file-uploader.view",defaultMessage:"View"}});function ae({item:e,uploadVariant:q,createDownloadAction:c,createCustomActions:i,onDelete:D,onRetry:I,onView:S}){var R,k,p,u,M,r;const B=ee(e.type==="local"?e.file:void 0),g=P(),d=[],w=c==null?void 0:c(e),y=i==null?void 0:i(e),z=()=>{if(e.response&&typeof e.response=="object"&&"deletable"in e.response)return!e.response.deletable};y&&d.push(...y),q===f.Immediate&&((R=e.request)==null?void 0:R.status)===t.Failed&&d.push({icon:se,name:g.formatMessage(b.retry),onClick:h}),w&&((k=e.request)==null?void 0:k.status)!==t.Deleted&&d.push({icon:ne,name:g.formatMessage(b.download),...w}),S&&((p=e.request)==null?void 0:p.status)!==t.Deleted&&d.push({icon:te,name:g.formatMessage(b.view),onClick:()=>S(e.id)}),q===f.Immediate?(e.type==="local"&&e.request&&([t.Uploaded,t.Invalid].includes(e.request.status)||e.request.status===t.Failed&&e.request.previousStatus!==t.Deleting)||e.type==="remote"&&(!e.request||e.request.status===t.Attached))&&d.push({icon:K,name:g.formatMessage(b.delete),isHidden:z(),onClick:x}):(e.type==="local"&&e.request&&[t.Attached,t.Failed,t.Invalid].includes(e.request.status)||e.type==="remote"&&!e.request)&&d.push({icon:K,name:g.formatMessage(b.delete),isHidden:z(),onClick:x});function x(){D(e.id)}function h(){I(e.id)}return l.jsx($,{fileName:e.name,status:((u=e.request)==null?void 0:u.status)??(e.type==="local"?t.Idle:t.Attached),progressValue:e.type==="local"&&((M=e.request)==null?void 0:M.status)===t.Uploading?B:void 0,message:(r=e.request)==null?void 0:r.message,onCancel:q===f.Immediate?x:void 0,actions:d})}function Ie({uploadUrlParams:e,baseDeleteUrlParams:q,itemsAtom:c,uploadVariant:i,Deleter:D,Uploader:I,warnWhenNavigatingAway:S=!0,createDownloadAction:B,createCustomActions:g,mapItemsForFileViewer:d,fileViewerTitle:w,maxFileCountInList:y,viewerModalProps:z,onBeforeDelete:x,onUploadComplete:h,...R}){v(i===f.OnDemand||D&&I&&e&&q,"Uploader and Deleter is required for Immediate upload variant"),v(y===void 0||d,"mapItemsForFileViewer is required when maxFileCountInList is provided");const k=P(),[p,u]=X(c),M=V(),r=d==null?void 0:d(p),[Q,O]=Y.useState(void 0),A=s=>{const n=new j(s.map(o=>{const a=N();return[a,{id:a,type:"local",name:o.name,file:o,request:{id:a,status:i===f.Immediate?t.Idle:t.Attached}}]})).reverse();if(u(j.concat(n,"prepend")),i===f.OnDemand&&h)for(const[o,a]of n)h(a,!0,o);if(i===f.Immediate){v(I,"Uploader is required for Immediate upload variant"),v(e,"uploadUrlParams is required for Immediate upload variant");for(const[o,a]of n)M({id:o,render:({onDone:m,...E})=>l.jsx(I,{id:o,file:a.file,itemsAtom:c,urlParams:e,onDone:U=>{m(U),h==null||h(a,U,o)},...E})})}},G=s=>{const n=new j(s.map(o=>{const a=N();return[a,{id:a,type:"local",name:o.file.name,file:o.file,request:{id:a,status:t.Invalid,message:_(o,k,{maxFileSizeInMb:R.maxFileSizeInMb})}}]})).reverse();u(j.concat(n,"prepend"))};function J(s){var o,a,m;const n=p.get(s);n&&(n.type==="local"&&((o=n.request)!=null&&o.previousStatus)&&[t.Uploading,t.Processing].includes((a=n.request)==null?void 0:a.previousStatus)?(v(I,"Uploader is required for Immediate upload variant"),v(e,"uploadUrlParams is required for Immediate upload variant"),M({id:s,render:E=>l.jsx(I,{id:s,file:n.file,itemsAtom:c,urlParams:e,...E}),onQueued:()=>u(H(n.id,t.Idle))})):((m=n.request)==null?void 0:m.previousStatus)===t.Deleting&&C(s))}async function C(s){var a;const n=p.get(s);!n||!(!x||await x(n))||(i===f.Immediate?(v(D,"Deleter is required for Immediate upload variant"),v(q,"baseDeleteUrlParams is required for Immediate upload variant"),M({id:s,isCancellation:!0,render:m=>l.jsx(D,{id:s,itemsAtom:c,baseUrlParams:q,...m}),onQueued:()=>u(H(s,t.Deleting)),onDone:m=>m&&u(j.delete(s))})):n.type==="local"&&((a=n.request)==null?void 0:a.status)!==t.Uploaded?u(j.delete(s)):u(H(s,t.Deleted)))}async function L(s){const n=r==null?void 0:r.theKeys.indexOf(s);O(n!==-1?n:void 0)}let T=p;return i===f.OnDemand&&!D&&(T=p.filter(s=>{var n;return((n=s.request)==null?void 0:n.status)!==t.Deleted})),l.jsxs(l.Fragment,{children:[l.jsx(Z,{...R,items:T,renderItem:s=>l.jsx(ae,{item:s,uploadVariant:i,createDownloadAction:B,createCustomActions:g,onDelete:C,onRetry:J,onView:r!=null&&r.has(s.id)?L:void 0}),warnWhenNavigatingAway:S,onDropAccepted:A,onDropRejected:G,maxFileCountInList:y,onViewMoreClick:()=>O(y)}),l.jsx(F,{open:Q!==void 0,onClose:()=>O(void 0),withFileList:((r==null?void 0:r.length)??0)>1,files:(r==null?void 0:r.theValues)??[],onDelete:({id:s})=>{s&&(O(void 0),C(s))},title:w,initialPreviewFileIndex:Q,...z})]})}export{Ie as D};
