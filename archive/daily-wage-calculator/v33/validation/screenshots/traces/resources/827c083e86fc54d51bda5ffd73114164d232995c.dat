import{b1 as be,b7 as K,ak as $,he as Z,aj as U,a9 as Ce,a as z,j as s,a2 as oe,a3 as V,d as q,H as E,af as v,gy as ve,h2 as we,P as ke,T as J,ha as te,ck as se,j5 as Se,r as w,B as je,j6 as Me,j7 as ie,cV as le,j8 as Re,an as De,ad as Ie,ae as Ae,j9 as Le,Z as Te,c2 as Oe,ct as ne}from"./assets/index-rhBbSAok.js";import{c as We}from"./createSheetsRow-rAhDxP-u__cache.js";import{c as $e}from"./copyTextToClipboard-rOz2YpPj__cache.js";import{u as Be}from"./useAutocomplete-m434FNIm__cache.js";import{A as Ee}from"./ArrowLeftIcon-Sfxicbe3__cache.js";import{A as Ne}from"./ArrowRightIcon-7MADsS01__cache.js";import{a as Ve}from"./DesktopDatePicker-nh7PrzvA__cache.js";import{P as Fe}from"./dateViewRenderers-rA8oPqeF__cache.js";import{m as He}from"./date-time-utils-I0Zx97XW__cache.js";import{D as Ke}from"./DesktopTimePicker-fmuGlJMu__cache.js";const Ue=({companyId:e})=>`/companies/${e}/external-excel/file`,Bt=()=>be({toURLFunction:Ue,options:{responseType:"blob",showGlobalProgress:!0}}),ze=(e,t)=>e.type===t.type?0:e.type==="error"?-1:t.type==="error"?1:e.type==="overridable-warning"?-1:1;function _e(e,t,n,r){const{r:a=[]}=e;return a.map(i=>{const{c}=i;let o="valid";const f=c.map((y,x)=>{const{c:C,m:b}=y;let m;b&&b.length>0&&(m=b.map(p=>{const g=qe(p);return g.type==="error"?o="has-error":g.type==="overridable-warning"?o!=="has-error"&&(o="has-overridable-warning"):g.type==="warning"&&o==="valid"&&(o="has-warning"),g}));const h={content:C,displayValue:K.isUndefined(C)?"":String(C),messages:m==null?void 0:m.sort(ze),disabled:y.d},d=t[x];if(!C)return h;switch(d.type){case"date":{try{h.content=Ce(C),h.displayValue=U(h.content,$.DATE_FIELD)}catch{return h}break}case"time":{try{h.content=Z(C,$.TIME_FULL,new Date),h.displayValue=U(h.content,$.TIME_FULL)}catch{return h}break}case"select":{if(d.enumWithDictationOptions){for(let p=0;p<n.length;p++){const g=d.enumWithDictationOptions.filter(M=>{var I;const T=(I=M.keyColumnValues)==null?void 0:I[p];if(T){const R=t.findIndex(D=>D.key===n[p]);return T===c[R].c}return!1});if(g.length===1){h.content=g[0],h.displayValue=h.content.value??"";break}}typeof h.content=="string"&&h.content===C&&(h.content={value:C})}break}case"enum":{d.enumOptions&&(h.content=d.enumOptions.find(p=>p.id===C),h.content&&(h.displayValue=h.content.name??h.content.id));break}case"number":{h.content=parseFloat(C);break}case"boolean":{h.content=C==="true";break}}return h});return We({cells:f,validityStatus:o,recordStatus:r?"modified":"not-changed"})})}function qe(e){const{et:t,t:n}=e;let r="error";return t==="error"?r="error":t==="overridable-warning"?r="overridable-warning":t==="warning"&&(r="warning"),{type:r,text:n}}function Et(e){const{c:t,d:n,a:r,k:a}=e,i={canAddRow:!(r!=null&&r.a),canCloneRow:!(r!=null&&r.c),canDeleteRow:!(r!=null&&r.d)},c=t.map(f=>{const{k:y,n:x,d:C,h:b,c:m,r:h,t:d,e:p,s:g,de:M}=f;let T,I;return d==="enum"&&p?T=p.map(R=>{const{i:D,n:A}=R;return{id:D,name:A}}):d==="select"&&g&&(I=g.map(R=>{const{v:D,l:A}=R,O=Xe(A),B=[],_=a.map(F=>{const H=A==null?void 0:A[F];if(H)return y!==F&&B.push(H),H;if(y===F)return D});return{value:D,additionalData:B.join(", "),linkedFields:O,keyColumnValues:_}})),{key:y,title:x,disabled:C,type:d,enumOptions:T,enumWithDictationOptions:I,hidden:b,required:h,avoidClone:m,description:M}}),o=_e(e,c,a,!1);return{columns:c,rows:o,keyColumnIds:a,sheetName:n,actions:i}}function Xe(e){return e?Object.entries(e).map(([t,n])=>({key:t,value:n})):void 0}async function Ye(){return await navigator.clipboard.readText()}const Ge=({open:e,contextMenuInfo:t,"data-external-id":n,onClose:r,onColumnSort:a,onRetriggerContextMenu:i,rowContextMenuItems:c})=>{const o=z();if(!t)return null;const{point:f,base:y}=t,x=y==="column"||!!(c&&(c==null?void 0:c.length)>0);return s.jsx(oe,{keepMounted:!0,open:e&&x,onClose:r,anchorReference:"anchorPosition",anchorPosition:e?{top:f.y,left:f.x}:void 0,onContextMenu:i,"data-external-id":n,children:y==="row"?s.jsx("div",{children:c}):s.jsxs("div",{children:[s.jsx(V,{"data-external-id":"sort-column-asc",onClick:()=>a("asc"),children:o.formatMessage(re.sortAscending)}),s.jsx(V,{"data-external-id":"sort-column-desc",onClick:()=>a("desc"),children:o.formatMessage(re.sortDescending)})]})})},re=q({sortAscending:{id:"common.action.sort-ascending",defaultMessage:"Sort ascending"},sortDescending:{id:"common.action.sort-descending",defaultMessage:"Sort descending"}}),Y=(e,t)=>({padding:e.spacing(1),maxWidth:250,borderLeft:"3px solid "+t,borderBottom:"2px solid "+v.grey[100]}),Ze=E()(e=>({popper:{zIndex:e.zIndex.modal+1},errorPopoverStyle:Y(e,e.palette.error.main),warningPopoverStyle:Y(e,e.palette.warning.main),infoPopoverStyle:Y(e,e.palette.info.main),errorLabel:{color:e.palette.error.main},warningLabel:{color:e.palette.warning.main},infoLabel:{color:e.palette.info.main}})),Je=({open:e,errorInfo:t,"data-external-id":n})=>{const r=z(),{classes:a,cx:i}=Ze();return t?s.jsx(ve,{open:!!e,className:a.popper,anchorEl:t==null?void 0:t.element,placement:"right-start",transition:!1,"data-external-id":n,children:({TransitionProps:c})=>s.jsx(we,{...c,timeout:350,children:s.jsx(s.Fragment,{children:t.messages.map((o,f)=>s.jsxs(ke,{className:i({[a.warningPopoverStyle]:o.type==="warning"||o.type==="overridable-warning",[a.errorPopoverStyle]:!o.type||o.type==="error",[a.infoPopoverStyle]:o.type==="info"}),children:[s.jsx(J,{variant:"body1",className:i({[a.warningLabel]:o.type==="warning"||o.type==="overridable-warning",[a.errorLabel]:!o.type||o.type==="error",[a.infoLabel]:o.type==="info"}),children:Qe(r,o.type)}),s.jsx(J,{variant:"caption",display:"block",children:o.text})]},`message-${f}`))})})}):null};function Qe(e,t){switch(t){case"error":return e.formatMessage({id:"sheets.error",defaultMessage:"Error"});case"overridable-warning":return e.formatMessage({id:"sheets.overridable-warning",defaultMessage:"Overridable Warning"});case"warning":return e.formatMessage({id:"sheets.warning",defaultMessage:"Warning"});case"info":return e.formatMessage({id:"sheets.info",defaultMessage:"Info"});default:return e.formatMessage({id:"sheets.error",defaultMessage:"Error"})}}const Pe=E()(e=>({listbox:{width:"auto",maxHeight:400,margin:0,padding:0,zIndex:1,position:"absolute",listStyle:"none",backgroundColor:e.palette.background.paper,overflow:"auto",border:"1px solid rgba(0,0,0,.25)",[`& li.${te.focused}`]:{backgroundColor:"#4a8df6",color:"white",cursor:"pointer"},[`& li.${te.active}`]:{backgroundColor:"#2977f5",color:"white"}}})),et=({value:e,onEditingClose:t,onCellValueChange:n,className:r,inputPoint:a,column:i,"data-external-id":c})=>{const o=z(),{classes:f}=Pe(),{getRootProps:y,getInputProps:x,getListboxProps:C,getOptionProps:b,getClearProps:m,groupedOptions:h}=Be({id:"autocomplete-field",options:i.enumWithDictationOptions??[],getOptionLabel:g=>(g==null?void 0:g.value)??"",isOptionEqualToValue:(g,M)=>g===M,onChange:(g,M)=>n(M),value:e||null,open:!0,onClose:t}),{onClick:d,tabIndex:p}=m();return s.jsx(se,{onClickAway:t,children:s.jsxs("div",{children:[s.jsx("div",{...y(),children:s.jsx("input",{autoFocus:!0,style:{left:a==null?void 0:a.x,top:a==null?void 0:a.y},className:r,"data-external-id":c,...x()})}),h.length>0?s.jsxs(Se,{role:"menu",style:{left:(a==null?void 0:a.x)||0,top:((a==null?void 0:a.y)||0)+W},className:f.listbox,...C(),children:[s.jsx(V,{tabIndex:p,onClick:g=>d==null?void 0:d(g),children:s.jsx("em",{children:o.formatMessage(tt.none)})}),h.map((g,M)=>w.createElement(V,{...b({option:g,index:M}),key:M},(g==null?void 0:g.value)&&s.jsx(J,{variant:"subtitle1",children:g.value}),(g==null?void 0:g.additionalData)&&s.jsx(je,{pl:2,children:s.jsxs(Me,{variant:"subtitle2",children:["(",g.additionalData,")"]})})))]}):null]})})},tt=q({none:{id:"common.none",defaultMessage:"None"}}),nt=E()(()=>({buttonAdornment:{[`& .${ie.root}`]:{margin:"0 auto"},fieldset:{borderColor:"transparent !important"}}})),rt=e=>s.jsx(le,{...e,children:s.jsx(Ee,{"data-external-id":"ArrowLeftIcon"})}),at=e=>s.jsx(le,{...e,children:s.jsx(Ne,{"data-external-id":"ArrowRightIcon"})}),ot=({value:e,inputPoint:t,onCellValueChange:n,onEditingClose:r,className:a,"data-external-id":i})=>{const{classes:c,cx:o}=nt(),f=w.useCallback(y=>{n(y)},[n]);return s.jsx(Ve,{open:!0,slotProps:{actionBar:{actions:["clear"]},textField:{className:o(a,c.buttonAdornment),style:{left:t==null?void 0:t.x,top:(t==null?void 0:t.y)!==void 0?t.y-8:0}}},slots:{day:st,previousIconButton:rt,nextIconButton:at},className:a,value:e,onChange:f,onClose:r,format:$.DATE_FIELD,"data-external-id":i})},st=e=>s.jsx(Fe,{...e,"data-external-id":`picker-day-${U(e.day,$.DATE_ISO)}`}),it=w.forwardRef(({value:e,editingCellIndices:t,onEditingClose:n,onCellValueChange:r,className:a,inputPoint:i,"data-external-id":c},o)=>{const[f,y]=w.useState(K.isNil(e)?"":e);w.useEffect(()=>{y(K.isNil(e)?"":e)},[t,e]);const x=w.useCallback(m=>{m.key==="Escape"?n():m.key==="Enter"&&(r(f),n())},[f,r,n]),C=w.useCallback(()=>{r(f)},[f,r]),b=w.useCallback(m=>{y(m.target.value)},[]);return s.jsx(se,{onClickAway:n,children:s.jsx("input",{ref:o,autoFocus:!0,onKeyDown:x,className:a,style:{left:i==null?void 0:i.x,top:i==null?void 0:i.y},value:f,onChange:b,onBlur:C,"data-external-id":c})})}),lt=E()(()=>({buttonAdornment:{[`.${ie.root}`]:{margin:"0 auto"},fieldset:{borderColor:"transparent !important"}},hideAdditionalSpace:{[`.${Re.root}.${He.root}:after`]:{display:"none"}}})),dt=({value:e,inputPoint:t,onCellValueChange:n,onEditingClose:r,className:a,"data-external-id":i})=>{const{classes:c,cx:o}=lt(),f=w.useCallback(y=>{n(y)},[n]);return s.jsx(Ke,{ampm:!1,format:$.TIME_FULL,slotProps:{actionBar:{actions:["clear"]},textField:{className:o(a,c.buttonAdornment),style:{padding:1,left:t==null?void 0:t.x,top:(t==null?void 0:t.y)!==void 0?t.y-8:0}},popper:{className:c.hideAdditionalSpace}},className:a,value:e,open:!0,onChange:f,onClose:r,views:["hours","minutes","seconds"],"data-external-id":i})},ct=q({none:{id:"common.none",defaultMessage:"None"}}),ut=({onEditingClose:e,onCellValueChange:t,inputPoint:n,column:r,"data-external-id":a})=>{var y;const i=z(),c=w.useCallback(x=>{x.key==="Escape"&&e()},[e]),o=x=>{var b;const C=(b=r.enumOptions)==null?void 0:b.find(m=>m.id===x);t(C),e()},f=n?{top:n.y,left:n.x}:void 0;return s.jsxs(oe,{open:!0,onKeyDown:c,anchorReference:"anchorPosition",anchorPosition:f,onClose:e,MenuListProps:{dense:!0},slotProps:{paper:{style:{maxHeight:300,minWidth:200}}},"data-external-id":a,children:[s.jsx(V,{value:"",onClick:()=>o(""),disableRipple:!0,"data-external-id":"sheets-select-none-option",children:s.jsx("em",{children:i.formatMessage(ct.none)})}),(y=r.enumOptions)==null?void 0:y.map(x=>{const C=`sheets-select-option-${x.id}`;return s.jsx(V,{value:x.id,onClick:()=>o(x.id),disableRipple:!0,"data-external-id":C,children:x.name},x.id)})]})},pt=E()(e=>({input:{position:"absolute",width:L,height:W+1,[`.${De.input}`]:{width:L,height:W+1,boxSizing:"content-box",outline:"none",margin:0,padding:4,lineHeight:"normal",boxShadow:"rgba(0, 0, 0, 0.4) 0px 2px 5px",border:"1px solid "+e.palette.info.main,background:"white",appearance:"none",borderRadius:0,fontFamily:"inherit",WebkitBoxSizing:"border-box",MozBoxSizing:"border-box"}}})),ft=w.forwardRef((e,t)=>{const{classes:n}=pt();return e.column.type==="enum"?s.jsx(ut,{...e,className:n.input,"data-external-id":"sheets-select-field"}):e.column.type==="select"?s.jsx(et,{...e,className:n.input,"data-external-id":"sheets-autocomplete-field"}):e.column.type==="date"?s.jsx(ot,{...e,className:n.input,"data-external-id":"sheets-datepicker-field"}):e.column.type==="time"?s.jsx(dt,{...e,className:n.input,"data-external-id":"sheets-timepicker-field"}):s.jsx(it,{...e,className:n.input,ref:t,"data-external-id":"sheets-text-field"})}),ht=e=>!e.messages||e.messages.length===0||e.messages.every(t=>t.type==="info"),gt=({cellIndices:e,cell:t,className:n,"data-external-id":r,disabled:a,onCellClick:i,onCellDoubleClick:c,onMouseEnterWithError:o,onMouseLeaveWithError:f,...y})=>{const x=ht(t),C=()=>{a||c(e)},b=()=>{x&&i(e)},m=d=>{x||o(e,d.currentTarget)},h=()=>{x||f()};return s.jsx("td",{className:n,onClick:b,onDoubleClick:C,onMouseEnter:m,onMouseLeave:h,"data-external-id":r,...y,children:t.displayValue})},yt=e=>{let t;if(e.messages)for(let n=0;n<e.messages.length;n++){const r=e.messages[n];if(r.type==="error")return"error";r.type==="overridable-warning"?t="overridable-warning":!t&&r.type==="warning"&&(t="warning")}return t},xt=E()((e,t,n)=>({td:{paddingLeft:e.spacing(1),paddingRight:e.spacing(1),border:"1px inset "+v.grey[300],minWidth:L,maxWidth:L,height:W,textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",[`&.${n.rowActive}`]:{borderTop:"1px solid "+e.palette.info.dark,borderBottom:"1px solid "+e.palette.info.dark,backgroundColor:e.palette.info.light},[`&.${n.cellActive}`]:{border:"1px solid "+e.palette.info.dark,backgroundColor:e.palette.info.light},[`&.${n.disabled}`]:{color:v.grey[400]},[`&.${n.error}`]:{backgroundColor:e.palette.error.light},[`&.${n.warning}`]:{backgroundColor:e.palette.warning.light},[`&.${n.overridableWarning}`]:{backgroundColor:e.palette.warning.light,color:e.palette.error.main}},indexColumn:{paddingLeft:e.spacing(1),paddingRight:e.spacing(1),border:"1px inset "+v.grey[400],borderRight:"2px solid "+v.grey[400],backgroundColor:v.grey[300],fontWeight:e.typography.fontWeightBold,minWidth:N,[`&.${n.rowActive}`]:{border:"1px solid "+v.grey[600],borderRight:"2px solid "+v.grey[600],backgroundColor:v.grey[300]},[`&.${n.error}`]:{color:e.palette.error.main}},rowActive:{},cellActive:{},disabled:{},error:{},warning:{},overridableWarning:{}})),mt=w.forwardRef(({rows:e,columns:t,filteringRowsWithError:n=!1,selectedRowIndex:r,selectedCellIndices:a,onCellClick:i,onCellDoubleClick:c,onRowSelect:o,onMouseEnterWithError:f,onMouseLeaveWithError:y,customFilterMatchingFunc:x},C)=>{const{classes:b,cx:m}=xt(),h=x?e.some((d,p)=>x(d,p)):!1;return s.jsx("tbody",{ref:C,"data-external-id":"sheets-tbody",children:e.map((d,p)=>{const g=r===p,M=d.validityStatus==="has-error",T=h&&x?!x(d,p):!1;return n&&!M||x&&T?null:s.jsxs("tr",{"data-external-id":`sheets-tr-${p}`,children:[s.jsx("td",{onClick:()=>o(p),className:m(b.indexColumn,{[b.rowActive]:g,[b.error]:M}),"data-external-id":`sheets-td-index-column-${p}`,children:p+1}),d.cells.map((I,R)=>{const D=t[R],A=a?a[0]===p&&a[1]===R:!1,O=yt(I),B=D.disabled||I.disabled;return D.hidden?null:s.jsx(gt,{disabled:B,className:m(b.td,{[b.rowActive]:g,[b.cellActive]:!g&&A,[b.disabled]:B,[b.error]:O==="error",[b.warning]:O==="warning",[b.overridableWarning]:O==="overridable-warning"}),cellIndices:[p,R],cell:I,onCellClick:i,onCellDoubleClick:c,onMouseEnterWithError:f,onMouseLeaveWithError:y,"data-external-id":`sheets-td-${p}-${R}`,"data-error":O==="error"?"true":void 0,"data-warning":O==="warning"?"true":void 0,"data-overridable-warning":O==="overridable-warning"?"true":void 0,"data-disabled":B?"true":void 0},R)})]},p)})})}),de="arrows-diagrams/arrow-rectangle-down",bt=`${Ae}#${de}`,ce=Ie(s.jsx("use",{href:bt}),"ArrowRectangleDown");ce.id=de;const ue=E()(e=>({thead:{fontWeight:e.typography.fontWeightBold,backgroundColor:v.grey[300]},th:{minWidth:L,maxWidth:L,border:"1px inset "+v.grey[400],borderBottom:"2px solid "+v.grey[400],"&.disabled":{color:v.grey[500]},position:"relative",textAlign:"left"},indexColumn:{paddingLeft:e.spacing(1),paddingRight:e.spacing(1),border:"1px inset "+v.grey[400],borderRight:"2px solid "+v.grey[400],backgroundColor:v.grey[300],fontWeight:e.typography.fontWeightBold,minWidth:N,"&.active":{border:"1px solid "+v.grey[600],borderRight:"2px solid "+v.grey[600],backgroundColor:v.grey[300]},"&.error":{color:e.palette.error.main}},thContextMenuButton:{position:"absolute",border:"1px solid"+v.grey[400],borderRadius:2,color:v.grey[400],zIndex:e.zIndex.tooltip,width:15,height:15,right:10,top:4,"&:hover":{border:"1px solid"+v.grey[600],backgroundColor:v.grey[100],cursor:"pointer",color:v.grey[600]}},titleContainer:{display:"flex",alignItems:"center",justifyContent:"space-between",paddingLeft:e.spacing(1)},titleWithLimitedWidth:{width:"calc(100% - 30px)"},infoCircleIcon:{marginLeft:e.spacing(.5),color:v.grey[500],fontSize:16}})),Ct=w.forwardRef(({columns:e,onContextMenuButtonClick:t},n)=>{const{classes:r,cx:a}=ue();return s.jsx("thead",{ref:n,className:r.thead,"data-external-id":"sheets-thead",children:s.jsxs("tr",{"data-external-id":"sheets-header-row",children:[s.jsx("th",{className:a(r.th,r.indexColumn),"data-external-id":"sheets-th-index-column"}),e.map((i,c)=>i.hidden?null:s.jsx(vt,{column:i,onContextMenuButtonClick:t,"data-external-id":`sheets-th-${c}`},i.key))]})})}),vt=({column:e,onContextMenuButtonClick:t,"data-external-id":n})=>{const[r,a]=w.useState(!1),{classes:i,cx:c}=ue();return s.jsxs("th",{className:c(i.th,e.disabled&&"disabled"),onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),"data-external-id":n,children:[s.jsxs("div",{className:c(i.titleContainer,{[i.titleWithLimitedWidth]:!!e.description}),children:[e.title,e.required?" *":"",e.description&&s.jsx(Le,{title:e.description,children:s.jsx(Te,{className:i.infoCircleIcon,fontSize:"x-small"})})]}),r&&s.jsx(ce,{className:i.thContextMenuButton,onClick:o=>{t(o),a(!1)},fontSize:"x-small"})]})},G=(e,t)=>{if(t===0&&e[0].hidden)return 1;let n=0;for(let r=0;r<t;r++)e[r].hidden&&n++;return n},wt=(e,t)=>{let n=0;for(let r=e.length-1;t<r;r--)e[r].hidden&&n++;return n},kt=(e,t)=>{const r=e.filter(i=>!i.hidden)[t];return r?e.findIndex(i=>i.key===r.key):void 0},W=23,L=200,N=60,St=E()(()=>({container:{height:"85vh",overflow:"auto"},table:{borderCollapse:"collapse",border:"1px inset "+v.grey[300],backgroundColor:v.grey[0]}})),Nt=({columns:e,rows:t,rowContextMenuItems:n,onCellValueUpdate:r,onColumnSort:a})=>{var Q,P,ee;const i=z(),{warning:c}=Oe(),o=w.useRef(null),f=w.useRef(null),y=w.useRef(null),x=w.useRef(null),C=w.useRef(null),{classes:b}=St(),[m,h]=w.useState(),[d,p]=w.useState(),[g,M]=w.useState(),[T,I]=w.useState(),[R,D]=w.useState(),A=l=>{if(f.current&&y.current){const u=f.current.getBoundingClientRect(),S=y.current.getBoundingClientRect(),j=Math.floor((l.clientX-u.x-N)/L),k=Math.floor((l.clientY-u.y-S.height)/(W+1));k>=0?(I({point:{x:l.clientX,y:l.clientY},base:"row"}),p({rowIdentifiers:{index:k,id:t[k].id}})):k<0&&j>=0&&(I({point:{x:l.clientX,y:l.clientY},base:"column"}),p({headerColumnIndex:kt(e,j)}))}l.preventDefault()},O=l=>{p({cellIndices:l})},B=l=>{p({rowIdentifiers:{index:l,id:t[l].id}})},_=l=>{if(x.current){const u=x.current.getBoundingClientRect();h(l),M({y:window.scrollY+u.y+l[0]*(W+1),x:window.scrollX+u.x+(l[1]-G(e,l[1]))*L+N})}},F=(l,u)=>{const S=t[l[0]].cells[l[1]].messages;S&&D({messages:S,element:u})},H=()=>{D(void 0)},pe=l=>{m&&(r(m,l),D(void 0))},X=()=>{p({}),I(void 0)},fe=l=>{if(!m&&(y!=null&&y.current)&&o.current&&(d!=null&&d.cellIndices))if(["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"].includes(l.key)){const u=d.cellIndices,S=y.current.getBoundingClientRect(),j=o.current.getBoundingClientRect();if(l.key==="ArrowLeft"){const k=u[1]-G(e,u[1]);k>0&&p({cellIndices:[u[0],u[1]-1]}),(k-1)*L+N<=o.current.scrollLeft&&o.current.scrollBy(-L,0)}else if(l.key==="ArrowRight"){const k=wt(e,u[1]),me=G(e,u[1]);u[1]<e.length-1-k&&p({cellIndices:[u[0],u[1]+1]}),j.width+o.current.scrollLeft<=(u[1]-me+2)*L+N&&o.current.scrollBy(L,0)}else l.key==="ArrowUp"?(u[0]>0&&p({cellIndices:[u[0]-1,u[1]]}),(u[0]-1)*W<=o.current.scrollTop-S.height&&o.current.scrollBy(0,-W-1)):l.key==="ArrowDown"&&(u[0]<t.length-1&&p({cellIndices:[u[0]+1,u[1]]}),j.height-S.height+o.current.scrollTop<(u[0]+3)*(W+1)&&o.current.scrollBy(0,W+1));l.preventDefault()}else l.key==="Enter"&&(d!=null&&d.cellIndices)?_(d.cellIndices):(l.metaKey||l.ctrlKey)&&l.code==="KeyC"?he(d.cellIndices):(l.metaKey||l.ctrlKey)&&l.code==="KeyV"&&ge(d.cellIndices)},he=l=>{const u=t[l[0]].cells[l[1]];$e(u.displayValue||"")},ge=async l=>{const u=await Ye(),S=e[l[1]];if(u&&!S.disabled){let j=u;switch(S.type){case"select":{S.enumWithDictationOptions&&(j=S.enumWithDictationOptions.find(k=>k.value===u));break}case"enum":{S.enumOptions&&(j=S.enumOptions.find(k=>k.name===u));break}case"date":{try{const k=Z(u,$.DATE_FIELD,new Date);j=ne(k)?k:void 0}catch{j=void 0}break}case"time":{try{const k=Z(u,$.TIME_FULL,new Date);j=ne(k)?k:void 0}catch{j=void 0}break}case"number":{j=parseInt(u),isNaN(j)&&(j=void 0);break}case"boolean":{(u==="true"||u==="false")&&(j=u==="true");break}}j?(r(l,j),D(void 0)):S.type!=="select"&&S.type!=="enum"?c({message:i.formatMessage(ae.pastedValueInvalidProvideValidType,{columnType:S.type})}):c({message:i.formatMessage(ae.pastedValueInvalidOption)})}},ye=l=>{d&&K.isNumber(d.headerColumnIndex)&&a({columnIndex:d.headerColumnIndex,direction:l}),X()},xe=()=>{X()};return s.jsxs("div",{ref:o,className:b.container,children:[m&&s.jsx(ft,{ref:C,editingCellIndices:m,inputPoint:g,column:e[m[1]],value:(P=(Q=t[m[0]])==null?void 0:Q.cells[m[1]])==null?void 0:P.content,onCellValueChange:pe,onEditingClose:()=>h(void 0)}),s.jsx(Ge,{open:!!T,contextMenuInfo:T,onClose:X,onColumnSort:ye,onRetriggerContextMenu:A,rowContextMenuItems:n==null?void 0:n.map((l,u)=>{var S;return l&&s.jsx(l,{onClick:xe,selectedRowId:(S=d==null?void 0:d.rowIdentifiers)==null?void 0:S.id},`row-context-menu-item-${u}`)}),"data-external-id":"sheets-context-menu"}),s.jsx(Je,{open:!!R,errorInfo:R,"data-external-id":"sheets-error-popover"}),s.jsxs("table",{tabIndex:0,ref:f,className:b.table,onKeyDown:fe,onContextMenu:A,"data-external-id":"sheets-table",children:[s.jsx(Ct,{ref:y,columns:e,onContextMenuButtonClick:A}),s.jsx(mt,{ref:x,columns:e,rows:t,onCellClick:O,onCellDoubleClick:_,onMouseEnterWithError:F,onMouseLeaveWithError:H,selectedRowIndex:(ee=d==null?void 0:d.rowIdentifiers)==null?void 0:ee.index,selectedCellIndices:d==null?void 0:d.cellIndices,onRowSelect:B})]})]})},ae=q({pastedValueInvalidProvideValidType:{id:"sheets.error.pasted-value-invalid-provide-valid-type",defaultMessage:"Pasted value is not a valid one. Provide a valid {columnType} value."},pastedValueInvalidOption:{id:"sheets.error.pasted-value-invalid-option",defaultMessage:"Pasted value is not a valid option"}});function Vt(e,t="sheet"){const n=URL.createObjectURL(new Blob([e],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"})),r=document.createElement("a");r.style.display="none",r.setAttribute("href",n),r.setAttribute("download",`${t}.xlsx`),document.body.appendChild(r),r.click(),document.body.removeChild(r)}function Ft(e,t,n){const r={r:[]};return e&&(r.r=e.map(a=>({c:a.cells.map((i,c)=>{const o=t[c];let f=i.content;return K.isUndefined(i.content)?{c:void 0}:(o.type==="date"?f=U(i.content,$.DATE_ISO):o.type==="number"?f=i.content:o.type==="select"?f=i.content.value:o.type==="enum"?f=i.content.id:o.type==="time"&&(f=U(i.content,$.TIME_FULL)),{c:f})})}))),n&&(r.c=t.map(a=>{var i,c;return{k:a.key,n:a.title,t:a.type,c:a.avoidClone,d:a.disabled,e:(i=a.enumOptions)==null?void 0:i.map(o=>({i:o.id,n:o.name})),h:a.hidden,r:a.required,s:(c=a.enumWithDictationOptions)==null?void 0:c.map(o=>({v:o.value,l:jt(o.linkedFields)})),de:a.description}})),r}function jt(e){if(e)return e.reduce((t,n)=>(t[n.key]=n.value,t),{})}export{Nt as S,Ft as a,_e as b,Ct as c,Vt as d,mt as e,Et as t,Bt as u};
