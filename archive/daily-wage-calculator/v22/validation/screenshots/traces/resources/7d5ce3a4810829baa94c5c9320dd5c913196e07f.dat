import{O as ne,Q as q,cb as se,be as ke,c1 as oe,b2 as _e,kS as Re,kT as je,bD as Te,hV as Fe,a as k,r as b,j as a,fN as Be,k6 as Le,f_ as Pe,cn as H,T as g,ce as Ge,bW as De,aj as Ee,a0 as T,d as V,b1 as le,W as K,c2 as de,bN as ce,H as $e,gd as Ue,S as we,kU as ze,a2 as Oe,a3 as ee,bB as te,cX as Qe,cf as He,db as ae,X as ie,kN as qe,kO as Ve,c7 as Ke,br as Xe,dc as Ye,jU as Je,ag as Ze}from"./assets/index-rhBbSAok.js";import{m as re}from"./mapResponseArrayGenerator-jtAzkRDY__cache.js";import{a as We,u as et}from"./Invitations-rVsR6vn2__cache.js";import{S as ue}from"./SearchInput-CIzwHG7W__cache.js";import{F as tt}from"./TextField.form-wfmQrmdl__cache.js";import{c as at}from"./useDebouncedState-a416yYCf__cache.js";import{P as it}from"./Pagination-dJEsRaL9__cache.js";import{P as nt}from"./PaginatedTable-URXGw4_u__cache.js";import{e as st}from"./emailValidator-7aOWd_-7__cache.js";function me(e){const t={};return t.pendingCount=e.pending_count,t.registeredCount=e.registered_count,t.uninvitedCount=e.uninvited_count,t}const X=e=>`/companies/${e.companyId}/widgets/invitations`,Tt=e=>ke(X,e),ve=(e,t)=>{const i=ot.useMocker();return q({toURLFunction:X,mapResponseFunction:se(me),options:{isCancellable:!0,mocker:i}})(e,void 0,t)},ot=ne(ve),Ft=()=>oe({toURLFunction:X,mapResponseFunction:se(me)});function lt(e){const t={};return t.employeeCount=e.employee_count,t.dependantCount=e.dependant_count,t}const dt=e=>`/companies/${e.companyId}/widgets/members`,ge=(e,t)=>{const i=ct.useMocker();return q({toURLFunction:dt,mapResponseFunction:_e(lt),options:{isCancellable:!0,mocker:i}})(e,void 0,t)},ct=ne(ge);function pe(e){const t={};return t.id=e.id,t.firstName=e.first_name,t.lastName=e.last_name,t.companyName=e.company_name,t.preferredName=e.preferred_name,t.email=e.email,t.registered=e.registered,t.position=e.position,t.userId=e.user_id,t.officeId=e.office_id,t.departmentId=e.department_id,e.work_location&&(t.workLocation=Re(e.work_location)),t.workLocationDisplay=e.work_location_display,t.tradeLicenseId=e.trade_license_id,t.invitedAt=e.invited_at,t.nationality=e.nationality,t.hireDate=e.hire_date,t.reportsToName=e.reports_to_name,e.marital_status&&(t.maritalStatus=je(e.marital_status)),t.dateOfBirth=e.date_of_birth,e.gender&&(t.gender=Te(e.gender)),t.userLanguage=Fe(e.user_language),t.lineManagerId=e.line_manager_id,t.personalAddress=e.personal_address,t.allowedCheckInOfficeIds=e.allowed_check_in_office_ids,t}const fe=({companyId:e})=>`companies/${e}/employee-projections`,rt=(e,t,i)=>q({toURLFunction:fe,mapResponseFunction:re(pe),options:{isCancellable:!0}})(e,t,i),ut=()=>oe({toURLFunction:fe,mapResponseFunction:re(pe)}),h=V({employeeName:{id:"company-survey.invitation-dialog-participants-table.employee-name",defaultMessage:"Employee name"},addEmail:{id:"company-survey.invitation-dialog-participants-table.add-email",defaultMessage:"Add email address"},notInvited:{id:"company-survey.invitation-dialog-participants-table.not-invited",defaultMessage:"Not invited"},invitationSent:{id:"company-survey.invitation-dialog-participants-table.invitation-sent",defaultMessage:"Invitation sent"},sendInvite:{id:"company-survey.invitation-dialog-participants-table.send-invite",defaultMessage:"Send invite"},resendInvite:{id:"company-survey.invitation-dialog-participants-table.resend-invite",defaultMessage:"Resend invite"},email:{id:"company-survey.invitation-dialog-participants-table.email",defaultMessage:"Email"},noEmail:{id:"company-survey.invitation-dialog-participants-table.no-email",defaultMessage:"No email"},inviteStatus:{id:"company-survey.invitation-dialog-participants-table.invite-status",defaultMessage:"Invite status"},actions:{id:"company-survey.invitation-dialog-participants-table.actions",defaultMessage:"Actions"}}),ye=({pagination:e,onPageChange:t,data:i,totalRowCount:l,onEmailClick:d,onResendInvitation:m,onSendInvitation:c})=>{const n=k(),f=b.useMemo(()=>[{dataIndex:"participant",title:n.formatMessage(h.employeeName),accessor:(y,r)=>a.jsxs(Be,{sx:{padding:0},children:[a.jsx(Le,{children:a.jsx(Pe,{person:r})}),a.jsxs(H,{children:[a.jsx(g,{"data-external-id":"full-name",variant:"body2",children:Ge(r.participant)}),a.jsx(g,{color:"textSecondary",variant:"caption",display:"block",children:r.participant.position})]})]})},{dataIndex:"email",title:n.formatMessage(h.email),accessor:(y,r)=>r.email?a.jsx(g,{variant:"body2",children:r.email}):a.jsxs(a.Fragment,{children:[a.jsx(g,{color:"error",variant:"caption",display:"block",children:n.formatMessage(h.noEmail)}),a.jsx(De,{"data-external-id":"add-email-address-button",variant:"h1",onClick:p=>d(p.currentTarget,r.participant),children:a.jsx(g,{children:n.formatMessage(h.addEmail)})})]})},{dataIndex:"invitedAt",title:n.formatMessage(h.inviteStatus),accessor:(y,r)=>r.participant.invitedAt?a.jsxs(a.Fragment,{children:[a.jsx(g,{variant:"body2",children:n.formatMessage(h.invitationSent)}),a.jsx(g,{variant:"caption",color:"textSecondary",display:"block",children:Ee(r.participant.invitedAt,"dd/MM/yy, hh:mmaaa")})]}):a.jsx(g,{variant:"body2",children:n.formatMessage(h.notInvited)})},{dataIndex:"action",title:n.formatMessage(h.actions),accessor:(y,r)=>a.jsx(mt,{participant:r.participant,onResendInvitation:m,onSendInvitation:c})}],[n,d,m,c]);return a.jsx(nt,{variant:"outlined",data:i,paginationType:it.Basic,columns:f,pagination:e,totalRowCount:l,onPageChange:t})},mt=({participant:e,onSendInvitation:t,onResendInvitation:i})=>{const l=k();return e.email?e!=null&&e.invitedAt?a.jsx(T,{onClick:()=>i(e.id),"data-external-id":"resend-invite-button",variant:"outlined",children:a.jsx(g,{children:l.formatMessage(h.resendInvite)})}):a.jsx(T,{onClick:()=>t(e.id),"data-external-id":"send-invite-button",variant:"outlined",children:a.jsx(g,{children:l.formatMessage(h.sendInvite)})}):a.jsx(T,{disabled:!0,variant:"outlined",children:a.jsx(g,{children:l.formatMessage(h.sendInvite)})})},vt=e=>`companies/${e.companyId}/invitations/resend-all`,gt=()=>le({toURLFunction:vt,options:{showGlobalProgress:!0}}),pt=e=>`companies/${e.companyId}/employees/${e.employeeId}/invitations/resend`,ft=()=>le({toURLFunction:pt,options:{showGlobalProgress:!0}}),he=({refetch:e})=>{const t=k(),i=K(),l=de(),{handleRequestExceptionAlert:d}=ce(),{mutateAsync:m}=We(),{mutateAsync:c}=ft(),{mutateAsync:n}=gt();return{handleSendInvitation:async v=>{try{await m({urlParams:{companyId:i,employeeId:v}}),await e(),l.success({message:t.formatMessage(x.invitationSentNotification)})}catch(s){d(s,{fallbackMessage:t.formatMessage(x.invitationFailedNotification)})}},handleResendInvitation:async v=>{try{await c({urlParams:{companyId:i,employeeId:v}}),await e(),l.success({message:t.formatMessage(x.invitationResentNotification)})}catch(s){d(s,{fallbackMessage:t.formatMessage(x.invitationFailedNotification)})}},handleResendBulkInvitation:async()=>{try{await n({urlParams:{companyId:i}}),await e(),l.success({message:t.formatMessage(x.bulkInvitationResentNotification)})}catch(v){d(v,{fallbackMessage:t.formatMessage(x.invitationFailedNotification)})}},getHandleSendBulkInvitation:v=>async()=>{try{const s={total:0,failed:0},M=await v();s.total=M.length;const R=await Promise.allSettled(M.map(C=>m({urlParams:{companyId:i,employeeId:C.id}})));s.failed=R.filter(C=>C.status==="rejected").length,await e(),s.failed===0?l.success({message:t.formatMessage(x.bulkInvitationSentNotification)}):(s.failed<s.total&&l.success({message:t.formatMessage(x.bulkInvitationCountSuccessNotification,{success:s.total-s.failed})}),l.error({message:t.formatMessage(x.bulkInvitationCountFailedNotification,{failed:s.failed})}))}catch(s){d(s,{fallbackMessage:t.formatMessage(x.invitationFailedNotification)})}}}},x=V({invitationSentNotification:{id:"company-survey.invitation-dialog.invitation-sent",defaultMessage:"Invite sent successfully"},invitationFailedNotification:{id:"company-survey.invitation-dialog.invitation-failed",defaultMessage:"Invite couldn't be sent"},invitationResentNotification:{id:"company-survey.invitation-dialog.invitation-resent",defaultMessage:"Invite resent successfully"},bulkInvitationResentNotification:{id:"company-survey.invitation-dialog.bulk-invitation-resent",defaultMessage:"Invites resent successfully"},bulkInvitationSentNotification:{id:"company-survey.invitation-dialog.bulk-invitation-sent",defaultMessage:"Invites sent successfully"},bulkInvitationCountSuccessNotification:{id:"company-survey.invitation-dialog.bulk-invitation-count-success",defaultMessage:"{success} invites sent successfully"},bulkInvitationCountFailedNotification:{id:"company-survey.invitation-dialog.bulk-invitation-count-failed",defaultMessage:"{failed} invites couldn't be sent"}}),u=V({searchAnEmployee:{id:"company-survey.invitation-dialog.search-an-employee",defaultMessage:"Search an employee"},close:{id:"common.action.close",defaultMessage:"Close"},participantsNotRegistered:{id:"company-survey.invitation-dialog.participants-not-registered",defaultMessage:"Participants not registered on Bayzat"},emailSavedNotification:{id:"company-survey.invitation-dialog.email-saved",defaultMessage:"Email saved and invite sent successfully"},invitationFailedNotification:{id:"company-survey.invitation-dialog.invitation-failed",defaultMessage:"Invite couldn't be sent"},inviteParticipantsToSendInvitationCountPluralOne:{id:"company-survey.invitation-dialog.invite-all",defaultMessage:"Invite {participantsToSendInvitationCount, plural, one {# employee} other {# employees}}"},resendInviteToParticipantsToResendInvitationCount:{id:"company-survey.invitation-dialog.reinvite-all",defaultMessage:"Resend invite to {participantsToResendInvitationCount, plural, one {# employee} other {# employees}}"},enterEmailAddressFor:{id:"company-survey.email-invitation-dialog.enter-email-adress",defaultMessage:"Enter email address for {employeeName}"},thisEmailWillBe:{id:"company-survey.email-invitation-dialog.send-invite-to-join",defaultMessage:"This email will be used to send an invite to {employeeName} to join Bayzat"},emailAddress:{id:"company-survey.email-invitation-dialog.email-address",defaultMessage:"Email address"},saveAndSend:{id:"company-survey.email-invitation-dialog.save-and-send",defaultMessage:"Save and send"},youCanAlsoChoose:{id:"company-survey.invitation-dialog.you-can-invite-participants",defaultMessage:"You can also choose to invite these participants once the survey is sent out"},bulkActions:{id:"company-survey.invitation-dialog.bulk-actions",defaultMessage:"Bulk actions"}}),Y=$e()(e=>({emailButtonContainer:{display:"flex",justifyContent:"flex-end",gap:e.spacing(2)},emailContainer:{padding:e.spacing(3),gap:e.spacing(1),display:"flex",flexDirection:"column"},flexContainer:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",rowGap:e.spacing(1)},dialogContainer:{gap:e.spacing(3),display:"flex",flexDirection:"column",minHeight:0},tableContainer:{display:"flex",flexDirection:"column",overflowY:"auto",minHeight:"500px"},mobileFlexGrow1:{[e.breakpoints.down("md")]:{flexGrow:1}}})),xe=({anchorEl:e,onClose:t,participantsToSendInvitationCount:i,participantsToResendInvitationCount:l,onSendInvitationBulk:d,onResendInvitationBulk:m})=>{const c=k();return a.jsxs(Oe,{anchorEl:e,elevation:2,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},keepMounted:!1,open:e!==null,onClose:t,onClick:t,children:[i>0&&a.jsx(ee,{"data-external-id":"send-invitation-menu-item",onClick:d,children:a.jsx(H,{children:c.formatMessage(u.inviteParticipantsToSendInvitationCountPluralOne,{participantsToSendInvitationCount:i})})}),l>0&&a.jsx(ee,{"data-external-id":"resend-invitation-menu-item",onClick:m,children:a.jsx(H,{children:c.formatMessage(u.resendInviteToParticipantsToResendInvitationCount,{participantsToResendInvitationCount:l})})})]})},yt=Xe({email:[Ye,st]}),be=({anchorEl:e,selectedEmployee:t,onClose:i,onSuccess:l})=>{const d=k(),{classes:m}=Y(),c=K(),n=de(),{handleRequestExceptionAlert:f}=ce(),y=yt(),{mutateAsync:r}=et();te(!e||t,"employee has to be selected");const p=async s=>{te(t,"employee has to be selected");try{await r({urlParams:{companyId:c,employeeId:t.id},data:{workEmail:s.email}}),await l(),n.success({message:d.formatMessage(u.emailSavedNotification)})}catch(M){f(M,{fallbackMessage:d.formatMessage(u.invitationFailedNotification)})}},v=t==null?void 0:t.firstName;return a.jsx(Qe,{open:!!t&&e!==null,anchorEl:e,onClose:i,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},"data-external-id":"add-email-popover",children:a.jsx(He,{onSubmit:p,validate:y,render:({handleSubmit:s})=>a.jsxs("div",{className:m.emailContainer,children:[a.jsx(g,{"data-external-id":"email-dialog-title",variant:"h4",children:d.formatMessage(u.enterEmailAddressFor,{employeeName:v})}),a.jsx(g,{"data-external-id":"email-dialog-subtitle",variant:"body1",color:"textSecondary",children:d.formatMessage(u.thisEmailWillBe,{employeeName:v})}),a.jsx(tt,{fullWidth:!0,label:d.formatMessage(u.emailAddress),name:"email"}),a.jsxs("div",{className:m.emailButtonContainer,children:[a.jsx(ae,{variant:"outlined",onClick:i,"data-external-id":"close",children:d.formatMessage(u.close)}),a.jsx(ae,{"data-external-id":"save-email-and-send-invite",type:"submit",onClick:s,children:d.formatMessage(u.saveAndSend)})]})]})})})},Me=Ue(we,()=>({root:{[`.${ze.root}`]:{display:"flex",flexDirection:"column"}}}));function ht(e){return e.map(({invitedAt:t,...i})=>({...i,...t&&{invitedAt:Je(t)}}))}function xt(e){return e.map(t=>({id:t.id,email:t.email,participant:t,inviteStatus:t.invitedAt}))}const bt=at(500),Bt=({open:e,onClose:t,refetch:i,title:l,subtitle:d,onResendInvitation:m,onResendBulkInvitation:c})=>{var Z;const n=k(),f=K(),y=ie(qe),r=ie(Ve),{classes:p}=Y(),[v,s,M]=bt(""),[R,C]=b.useState(0),j=5,S={offset:R*j,limit:j},{data:{data:N}={data:{pendingCount:0,registeredCount:0,uninvitedCount:0}},isPending:F}=ve({companyId:f},{enabled:r}),{data:{employeeCount:_}={employeeCount:0,dependantCount:0}}=ge({companyId:f},{enabled:y}),{data:B={data:[]},refetch:G,isPending:D}=rt({companyId:f},{pagination:S,filters:{name:s,active:"true",userIdIsNull:"true"}},{placeholderData:Ze,enabled:e}),{mutateAsync:E}=ut(),L=async()=>{await G(),await i()},{handleSendInvitation:$,handleResendInvitation:U,handleResendBulkInvitation:w,getHandleSendBulkInvitation:z}=he({refetch:L}),[O,o]=b.useState(null),[I,Q]=b.useState(null),[Ce,Se]=b.useState(),Ie=(A,P)=>{Q(A),Se(P)},Ae=async()=>{Q(null),await L()},Ne=z(async()=>{const{data:A}=await E({urlParams:{companyId:f},queryParams:{filters:{active:"true",userIdIsNull:"true"},pagination:{offset:0,limit:_||9999}}});return A.filter(W=>!W.invitedAt&&!!W.email)}),J=d??n.formatMessage(u.youCanAlsoChoose);return a.jsx(Me,{maxWidth:"md",fullWidth:!0,title:l??n.formatMessage(u.participantsNotRegistered),open:e,content:a.jsxs("div",{className:p.dialogContainer,children:[J&&a.jsx(g,{"data-external-id":"subtitle",variant:"body1",color:"textSecondary",children:J}),a.jsxs("div",{className:p.flexContainer,children:[a.jsx(ue,{value:v,placeholder:n.formatMessage(u.searchAnEmployee),"data-external-id":"invitation-dialog-search-field",onChange:M,onClear:()=>M("")}),a.jsx(T,{className:p.mobileFlexGrow1,"data-external-id":"invitation-dialog-bulk-actions",variant:"contained",onClick:A=>o(A.currentTarget),children:n.formatMessage(u.bulkActions)})]}),a.jsx(Ke,{loading:D||F,children:a.jsx("div",{className:p.tableContainer,children:a.jsx(ye,{onResendInvitation:A=>{U(A),m==null||m()},onSendInvitation:$,data:xt(ht(B.data)),pagination:S,totalRowCount:((Z=B.pagination)==null?void 0:Z.total)??0,onPageChange:(A,P)=>C(P),onEmailClick:Ie})})}),a.jsx(xe,{onClose:()=>o(null),anchorEl:O,participantsToSendInvitationCount:N.uninvitedCount,participantsToResendInvitationCount:N.pendingCount,onResendInvitationBulk:()=>{w(),c==null||c()},onSendInvitationBulk:Ne}),a.jsx(be,{anchorEl:I,selectedEmployee:Ce,onClose:()=>Q(null),onSuccess:Ae})]}),cancelButton:{show:!0,text:n.formatMessage(u.close)},confirmButton:{show:!1},"data-external-id":"invitation-dialog",keepMounted:!1,autoFocusConfirmButton:!1,onClose:t})},Lt=({participants:e,refetch:t,open:i,onClose:l,title:d,subtitle:m})=>{const c=k(),{classes:n}=Y(),[f,y]=b.useState(null),[r,p]=b.useState(null),[v,s]=b.useState(0),[M,R]=b.useState(),[C,j]=b.useState(""),S=e.filter(o=>!o.invitedAt&&!!o.email),N=e.filter(o=>o.invitedAt&&!!o.email),F=5,_={offset:v*F,limit:F,total:e.length},B=e.filter(o=>{var I;return(I=o.nameForSearch)==null?void 0:I.includes(C.toLowerCase())}).map(o=>({id:o.id,email:o.email,participant:o,inviteStatus:o.invitedAt})).slice(v*_.limit,(v+1)*_.limit),G=o=>j(o),D=()=>j(""),E=(o,I)=>{p(o),R(I)},L=async()=>{p(null),await t()},{handleSendInvitation:$,handleResendInvitation:U,handleResendBulkInvitation:w,getHandleSendBulkInvitation:z}=he({refetch:t}),O=z(async()=>S);return a.jsx(Me,{maxWidth:"md",fullWidth:!0,title:d??c.formatMessage(u.participantsNotRegistered),open:i,content:a.jsxs("div",{className:n.dialogContainer,children:[a.jsx(g,{"data-external-id":"subtitle",variant:"body1",color:"textSecondary",children:m??c.formatMessage(u.youCanAlsoChoose)}),a.jsxs("div",{className:n.flexContainer,children:[a.jsx(ue,{value:C,placeholder:c.formatMessage(u.searchAnEmployee),"data-external-id":"invitation-dialog-search-field",onChange:G,onClear:D}),a.jsx(T,{className:n.mobileFlexGrow1,disabled:S.length<1&&N.length<1,"data-external-id":"invitation-dialog-bulk-actions",variant:"contained",onClick:o=>y(o.currentTarget),children:c.formatMessage(u.bulkActions)})]}),a.jsx("div",{className:n.tableContainer,children:a.jsx(ye,{onResendInvitation:U,onSendInvitation:$,data:B,pagination:_,totalRowCount:_.total,onPageChange:(o,I)=>s(I),onEmailClick:E})}),a.jsx(xe,{onClose:()=>y(null),anchorEl:f,participantsToSendInvitationCount:S==null?void 0:S.length,participantsToResendInvitationCount:N==null?void 0:N.length,onResendInvitationBulk:w,onSendInvitationBulk:O}),a.jsx(be,{anchorEl:r,selectedEmployee:M,onClose:()=>p(null),onSuccess:L})]}),cancelButton:{show:!0,text:c.formatMessage(u.close)},confirmButton:{show:!1},"data-external-id":"invitation-dialog",keepMounted:!1,autoFocusConfirmButton:!1,onClose:l})};export{Bt as I,ge as a,Ft as b,Lt as c,Tt as g,ve as u};
