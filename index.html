<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bayzat User Guides</title>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      line-height: 1.6;
      color: #1a1a2e;
      background: #f8f9ff;
      min-height: 100vh;
    }
    .header {
      background: linear-gradient(135deg, #6B46C1 0%, #805AD5 50%, #9F7AEA 100%);
      color: #fff;
      padding: 60px 40px 50px;
      text-align: center;
    }
    .header h1 { font-size: 2.5rem; font-weight: 700; margin-bottom: 12px; }
    .header p { font-size: 1.15rem; opacity: 0.92; max-width: 600px; margin: 0 auto; }
    .stats {
      display: flex;
      justify-content: center;
      gap: 40px;
      margin-top: 28px;
    }
    .stat { text-align: center; }
    .stat-number { font-size: 2rem; font-weight: 700; }
    .stat-label { font-size: 0.85rem; opacity: 0.85; text-transform: uppercase; letter-spacing: 0.05em; }
    .container { max-width: 1100px; margin: 0 auto; padding: 0 24px; }
    .search-bar {
      margin: -28px auto 32px;
      max-width: 560px;
      position: relative;
    }
    .search-bar input {
      width: 100%;
      padding: 16px 20px 16px 48px;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      font-size: 1rem;
      background: #fff;
      box-shadow: 0 4px 16px rgba(0,0,0,0.08);
      outline: none;
      transition: border-color 0.2s;
    }
    .search-bar input:focus { border-color: #6B46C1; }
    .search-bar svg {
      position: absolute;
      left: 16px;
      top: 50%;
      transform: translateY(-50%);
      color: #94a3b8;
      width: 20px;
      height: 20px;
    }
    .categories {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: center;
      margin-bottom: 32px;
    }
    .cat-btn {
      padding: 8px 18px;
      border-radius: 20px;
      border: 1px solid #e2e8f0;
      background: #fff;
      color: #475569;
      font-size: 0.85rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }
    .cat-btn:hover, .cat-btn.active {
      background: #6B46C1;
      color: #fff;
      border-color: #6B46C1;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 20px;
      padding-bottom: 60px;
    }
    .card {
      background: #fff;
      border-radius: 12px;
      border: 1px solid #e2e8f0;
      padding: 24px;
      text-decoration: none;
      color: inherit;
      transition: all 0.2s;
      display: flex;
      flex-direction: column;
    }
    .card:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 24px rgba(107,70,193,0.12);
      border-color: #6B46C1;
    }
    .card-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 12px;
    }
    .card-icon {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      flex-shrink: 0;
    }
    .card-title { font-size: 1.1rem; font-weight: 600; color: #1a1a2e; }
    .card-version {
      font-size: 0.75rem;
      color: #6B46C1;
      background: #f3e8ff;
      padding: 2px 8px;
      border-radius: 6px;
      font-weight: 500;
      margin-left: auto;
    }
    .card-desc {
      font-size: 0.88rem;
      color: #64748b;
      flex: 1;
      margin-bottom: 16px;
    }
    .card-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }
    .tag {
      font-size: 0.72rem;
      color: #6B46C1;
      background: #faf5ff;
      padding: 3px 10px;
      border-radius: 12px;
      border: 1px solid #e9d5ff;
    }
    .card-footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: 14px;
      padding-top: 12px;
      border-top: 1px solid #f1f5f9;
    }
    .card-audience {
      font-size: 0.78rem;
      color: #94a3b8;
      font-weight: 500;
    }
    .card-arrow {
      color: #6B46C1;
      font-size: 1.1rem;
      font-weight: 600;
    }
    .footer {
      text-align: center;
      padding: 32px;
      color: #94a3b8;
      font-size: 0.85rem;
      border-top: 1px solid #e2e8f0;
      background: #fff;
    }
    .no-results {
      text-align: center;
      padding: 60px 20px;
      color: #94a3b8;
      font-size: 1.1rem;
      grid-column: 1 / -1;
    }
    .loading {
      text-align: center;
      padding: 80px 20px;
      color: #94a3b8;
      font-size: 1.1rem;
      grid-column: 1 / -1;
    }
    .loading-spinner {
      display: inline-block;
      width: 32px;
      height: 32px;
      border: 3px solid #e2e8f0;
      border-top-color: #6B46C1;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin-bottom: 16px;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    .bg-payroll { background: #ecfdf5; }
    .bg-time { background: #eff6ff; }
    .bg-people { background: #fef3c7; }
    .bg-performance { background: #fce7f3; }
    .bg-settings { background: #f3e8ff; }
    .bg-security { background: #fee2e2; }
    .bg-automation { background: #e0f2fe; }
    .bg-default { background: #f1f5f9; }
  </style>
</head>
<body>
  <div class="header">
    <h1>Bayzat User Guides</h1>
    <p>Comprehensive guides for every feature on the Bayzat HR platform. Find step-by-step instructions, screenshots, and best practices.</p>
    <div class="stats">
      <div class="stat">
        <div class="stat-number" id="guide-count">-</div>
        <div class="stat-label">Guides</div>
      </div>
      <div class="stat">
        <div class="stat-number" id="cat-count">-</div>
        <div class="stat-label">Categories</div>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="search-bar">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>
      <input type="text" id="search" placeholder="Search guides by name or keyword..." autocomplete="off">
    </div>

    <div class="categories" id="categories">
      <button class="cat-btn active" data-cat="all">All</button>
    </div>

    <div class="grid" id="grid">
      <div class="loading">
        <div class="loading-spinner"></div>
        <div>Loading guides...</div>
      </div>
    </div>
  </div>

  <div class="footer" id="footer">Loading...</div>

  <script>
    // === Supabase read-only access ===
    const SUPABASE_URL = "https://wliqznyleighuggvtidj.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndsaXF6bnlsZWlnaHVnZ3Z0aWRqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMzODg4NDksImV4cCI6MjA3ODk2NDg0OX0.VsoY-dYVxfntIEZcXYHtkm4uZ493d5aNDTC9yLiMBEE";

    // === Visual metadata per slug (icon, category, short description) ===
    // New guides not in this map still appear with defaults derived from content_summary
    const META = {
      "360-feedback":              { icon: "ðŸ”„", cat: "performance", desc: "Run multi-rater feedback cycles with peer, manager, and self reviews." },
      "air-ticket":                { icon: "âœˆï¸", cat: "payroll",     desc: "Manage annual flight ticket allowances, encashments, and policies." },
      "approval-flow":             { icon: "âœ…", cat: "automation",  desc: "Configure multi-level approval chains for leave, expenses, payroll, and more." },
      "attendance":                { icon: "â°", cat: "time",        desc: "Track employee check-ins, manage attendance policies, and generate reports." },
      "bayzat-ai":                 { icon: "ðŸ¤–", cat: "settings",    desc: "Use AI-powered insights, reports, and the knowledge base chatbot." },
      "biometric-attendance":      { icon: "ðŸ‘†", cat: "time",        desc: "Set up facial recognition and fingerprint devices for attendance tracking." },
      "daily-wage-calculator":     { icon: "ðŸ§®", cat: "payroll",     desc: "Configure daily rate calculations for salary proration, leave deductions, and EOS." },
      "employee-tickets":          { icon: "ðŸŽ«", cat: "requests",    desc: "Manage HR requests including letters, loans, and support tickets." },
      "employee-violation":        { icon: "âš ï¸", cat: "people",      desc: "Track disciplinary actions, issue warnings, and manage violation records." },
      "end-of-service":            { icon: "ðŸ“‹", cat: "payroll",     desc: "Calculate gratuity, process final settlements, and manage employee exits." },
      "knowledge-hub":             { icon: "ðŸ“š", cat: "people",      desc: "Create and manage a company knowledge base with documents and FAQs." },
      "leave-encashment":          { icon: "ðŸ’°", cat: "payroll",     desc: "Process leave balance payouts and configure encashment policies." },
      "leave-management":          { icon: "ðŸ–ï¸", cat: "time",        desc: "Handle leave requests, approvals, balances, and time-off reporting." },
      "leave-policies":            { icon: "ðŸ“œ", cat: "time",        desc: "Configure leave types, accrual rules, carry-forward limits, and policy assignments." },
      "leave-salary":              { icon: "ðŸ’µ", cat: "payroll",     desc: "Process annual leave salary requests with flight ticket integration." },
      "letters":                   { icon: "ðŸ“„", cat: "requests",    desc: "Generate salary certificates, NOCs, offer letters, and other HR documents." },
      "loans":                     { icon: "ðŸ¦", cat: "payroll",     desc: "Manage employee loan requests, repayment schedules, and salary deductions." },
      "multifactor-authentication":{ icon: "ðŸ”", cat: "security",    desc: "Enable MFA with authenticator apps for enhanced login security." },
      "overtime":                  { icon: "â±ï¸", cat: "time",        desc: "Track extra hours, configure overtime policies, and process OT payments." },
      "payroll-management":        { icon: "ðŸ’³", cat: "payroll",     desc: "Run payroll cycles, generate payslips, and manage salary processing." },
      "performance":               { icon: "ðŸ“Š", cat: "performance", desc: "Manage review cycles, goals, OKRs, calibration, and 1-on-1 meetings." },
      "records-management":        { icon: "ðŸ—‚ï¸", cat: "people",      desc: "Manage employee profiles, bulk updates, custom groups, and data exports." },
      "role-management":           { icon: "ðŸ‘¥", cat: "settings",    desc: "Configure user roles, access permissions, and feature-level controls." },
      "shift-scheduling":          { icon: "ðŸ“…", cat: "time",        desc: "Create, publish, and manage employee shift schedules and rosters." },
      "split-shifts":              { icon: "âœ‚ï¸", cat: "time",        desc: "Configure divided work periods with breaks for flexible scheduling." },
      "surveys":                   { icon: "ðŸ“", cat: "performance", desc: "Create engagement surveys, pulse checks, and analyze employee sentiment." },
      "timesheets":                { icon: "ðŸ“‹", cat: "time",        desc: "Review daily attendance logs, hours tracking, and timesheet management." },
      "variable-pay":              { icon: "ðŸ’Ž", cat: "payroll",     desc: "Manage commissions, bonuses, and other variable compensation items." },
      "work-expenses":             { icon: "ðŸ§¾", cat: "requests",    desc: "Submit, approve, and reimburse employee expense claims." },
      "work-timings":              { icon: "ðŸ•", cat: "time",        desc: "Define work schedules, flexible timing, late arrival rules, and break policies." },
      "workflows":                 { icon: "âš¡", cat: "automation",  desc: "Build automated workflows with triggers, conditions, and task assignments." }
    };

    const CAT_LABELS = {
      payroll: "Payroll", time: "Time & Attendance", people: "People",
      performance: "Performance", requests: "Requests", settings: "Settings",
      security: "Security", automation: "Automation", other: "Other"
    };
    const CAT_BG = {
      payroll: "bg-payroll", time: "bg-time", people: "bg-people",
      performance: "bg-performance", requests: "bg-people", settings: "bg-settings",
      security: "bg-security", automation: "bg-automation", other: "bg-default"
    };

    function parseSummary(summary) {
      if (!summary) return { audience: "Admin", tags: [] };
      const lines = summary.split("\n");
      let audience = "Admin";
      let tags = [];
      for (const line of lines) {
        if (line.startsWith("Audience:")) {
          const val = line.replace("Audience:", "").trim().toLowerCase();
          audience = val === "both" ? "Admin & Employee" : val === "admin" ? "Admin" : "Admin & Employee";
        }
        if (line.startsWith("Also known as:")) {
          tags = line.replace("Also known as:", "").trim()
            .split(",").map(t => t.trim()).filter(t => t.length > 0 && t.length < 30).slice(0, 4);
        }
      }
      return { audience, tags };
    }

    const grid = document.getElementById("grid");
    const searchInput = document.getElementById("search");
    const categoriesDiv = document.getElementById("categories");
    let guides = [];
    let activeCategory = "all";

    function render(filter, cat) {
      filter = filter || "";
      cat = cat || "all";
      const q = filter.toLowerCase();
      const filtered = guides.filter(g => {
        const matchCat = cat === "all" || g.cat === cat;
        const matchSearch = !q ||
          g.name.toLowerCase().includes(q) ||
          g.desc.toLowerCase().includes(q) ||
          g.tags.some(t => t.toLowerCase().includes(q)) ||
          (g.allAliases && g.allAliases.toLowerCase().includes(q));
        return matchCat && matchSearch;
      });

      if (filtered.length === 0) {
        grid.innerHTML = '<div class="no-results">No guides match your search.</div>';
        return;
      }

      grid.innerHTML = filtered.map(g => `
        <a class="card" href="${g.url}" data-cat="${g.cat}">
          <div class="card-header">
            <div class="card-icon ${g.bg}">${g.icon}</div>
            <div class="card-title">${g.name}</div>
            <span class="card-version">v${g.version}</span>
          </div>
          <div class="card-desc">${g.desc}</div>
          <div class="card-tags">${g.tags.map(t => '<span class="tag">' + t + '</span>').join("")}</div>
          <div class="card-footer">
            <span class="card-audience">${g.audience}</span>
            <span class="card-arrow">&rarr;</span>
          </div>
        </a>
      `).join("");
    }

    function buildCategoryButtons() {
      const cats = new Set(guides.map(g => g.cat));
      let html = '<button class="cat-btn active" data-cat="all">All</button>';
      for (const [key, label] of Object.entries(CAT_LABELS)) {
        if (cats.has(key)) html += '<button class="cat-btn" data-cat="' + key + '">' + label + '</button>';
      }
      categoriesDiv.innerHTML = html;
    }

    async function loadGuides() {
      try {
        const res = await fetch(
          SUPABASE_URL + "/rest/v1/user_guides?select=feature_slug,feature_name,version,access_url,content_summary&status=eq.completed&order=feature_name.asc",
          { headers: { "apikey": SUPABASE_KEY, "Authorization": "Bearer " + SUPABASE_KEY } }
        );
        if (!res.ok) throw new Error("HTTP " + res.status);
        const rows = await res.json();

        guides = rows.map(function(row) {
          var slug = row.feature_slug;
          var meta = META[slug] || {};
          var parsed = parseSummary(row.content_summary);
          var allAliases = row.content_summary
            ? (row.content_summary.match(/Also known as:\s*(.+)/)||[])[1] || ""
            : "";
          return {
            slug: slug,
            name: row.feature_name,
            version: row.version,
            url: row.access_url,
            cat: meta.cat || "other",
            icon: meta.icon || "ðŸ“–",
            bg: CAT_BG[meta.cat] || "bg-default",
            desc: meta.desc || row.feature_name + " user guide.",
            audience: parsed.audience,
            tags: parsed.tags,
            allAliases: allAliases
          };
        });

        document.getElementById("guide-count").textContent = guides.length;
        document.getElementById("cat-count").textContent = new Set(guides.map(function(g){ return g.cat; })).size;
        document.getElementById("footer").innerHTML = "Powered by Supabase &middot; " + guides.length + " guides &middot; auto-updates when new guides are published";

        buildCategoryButtons();
        render();

        categoriesDiv.addEventListener("click", function(e) {
          if (!e.target.classList.contains("cat-btn")) return;
          categoriesDiv.querySelectorAll(".cat-btn").forEach(function(b){ b.classList.remove("active"); });
          e.target.classList.add("active");
          activeCategory = e.target.dataset.cat;
          render(searchInput.value, activeCategory);
        });

      } catch (err) {
        console.error("Failed to load guides:", err);
        grid.innerHTML = '<div class="no-results">Failed to load guides. Please refresh the page.</div>';
      }
    }

    searchInput.addEventListener("input", function() { render(searchInput.value, activeCategory); });
    loadGuides();
  </script>
</body>
</html>
